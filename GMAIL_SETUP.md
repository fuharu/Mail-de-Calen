# Gmail API 設定ガイド

Mail de CalenでGmailから実際のメールを取得するための設定手順です。

## 1. Google Cloud Console での設定

### 1.1 プロジェクトの作成・選択
1. [Google Cloud Console](https://console.cloud.google.com/) にアクセス
2. 新しいプロジェクトを作成するか、既存のプロジェクトを選択

### 1.2 Gmail API の有効化
1. 「APIとサービス」→「ライブラリ」に移動
2. 「Gmail API」を検索
3. 「有効にする」をクリック

### 1.3 OAuth 2.0 認証情報の作成
1. 「APIとサービス」→「認証情報」に移動
2. 「認証情報を作成」→「OAuth クライアント ID」を選択
3. アプリケーションの種類：「デスクトップアプリケーション」を選択
4. 名前を入力（例：「Mail de Calen Gmail Client」）
5. 「作成」をクリック

### 1.4 認証情報のダウンロード
1. 作成されたOAuth 2.0 クライアント IDをクリック
2. 「JSONをダウンロード」をクリック
3. ダウンロードしたファイルを `backend/credentials/gmail_credentials.json` として保存

## 2. アプリケーションの設定

### 2.1 認証情報ファイルの配置
```bash
# ダウンロードしたJSONファイルを以下の場所に配置
backend/credentials/gmail_credentials.json
```

### 2.2 初回認証の実行
1. バックエンドサーバーを起動
2. フロントエンドでメールタブにアクセス
3. 初回アクセス時にブラウザが開き、Google認証画面が表示される
4. Gmailアカウントでログインし、権限を許可

### 2.3 認証トークンの保存
- 認証が完了すると、`backend/tokens/token_[user_id].json` にトークンが保存されます
- このトークンにより、以降のアクセスでは再認証が不要になります

## 3. 機能の確認

### 3.1 メール取得の確認
1. Inboxページのメールタブにアクセス
2. データソースが「Gmail API」と表示されることを確認
3. 実際のGmailメールが表示されることを確認

### 3.2 メール検索の確認
1. 検索ボックスにキーワードを入力
2. 「検索」ボタンをクリック
3. 検索結果が表示されることを確認

### 3.3 メール解析の確認
1. メールをクリックして詳細表示
2. 「解析」ボタンをクリック
3. イベントやToDoの抽出結果が表示されることを確認

## 4. トラブルシューティング

### 4.1 認証エラー
- `gmail_credentials.json` が正しく配置されているか確認
- Google Cloud ConsoleでGmail APIが有効になっているか確認
- OAuth 2.0 クライアント IDが正しく設定されているか確認

### 4.2 権限エラー
- Gmail APIのスコープが正しく設定されているか確認
- ユーザーがGmailアカウントにアクセス権限を持っているか確認

### 4.3 メールが表示されない
- Gmailアカウントにメールが存在するか確認
- 認証トークンが有効か確認
- バックエンドのログでエラーメッセージを確認

## 5. セキュリティ注意事項

### 5.1 認証情報の管理
- `gmail_credentials.json` は機密情報です
- このファイルをGitリポジトリにコミットしないでください
- `.gitignore` に追加することを推奨します

### 5.2 トークンの管理
- `tokens/` ディレクトリ内のトークンファイルも機密情報です
- 定期的にトークンを更新することを推奨します

## 6. 開発時の注意点

### 6.1 モックデータとの切り替え
- Gmail認証情報が設定されていない場合、自動的にモックデータが使用されます
- データソースバッジで現在のデータソースを確認できます

### 6.2 レート制限
- Gmail APIにはレート制限があります
- 大量のメールを取得する場合は、適切な間隔を空けてリクエストしてください

## 7. 今後の拡張

### 7.1 追加機能
- メールの送信機能
- ラベルの管理
- フィルタリング機能
- メールの分類・自動処理

### 7.2 パフォーマンス改善
- メールのキャッシュ機能
- ページネーション
- 非同期処理の最適化
